<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:t="http://myfaces.apache.org/tomahawk"
                xmlns:p="http://primefaces.org/ui"
                template="/stylesheets/_definedStageTemplate.xhtml">
    <ui:define name="content">
        <p:panel>
            <f:facet name="header">
                <h:outputText value="#{msgs['CONVENTION.TITRE']}" />
            </f:facet>
            <h:form id="formConvention">
                <ui:include src="_roadmap.xhtml" />
                <p:panel
                        style="width:800px;position:relative;margin-left:auto;margin-right:auto;">
                    <f:facet name="header">
                        <h:outputText value="#{msgs['CONVENTION.ETAPE3.SERVICE']}" />
                    </f:facet>
                    <!-- 		<h:outputText -->
                    <!-- 			value="#{msgs['CONVENTION.ETAPE3.CHOIXSERVICE.DEMANDE']}" /> -->

                    <t:htmlTag value="div" style="height:10px;" />

                    <h:outputText
                            value="#{msgs['RECHERCHEETABLISSEMENT.ERREURSELECTION']}"
                            rendered="#{empty sessionController.currentManageStructure}" />
                    <h:outputText value="#{msgs['SERVICE.AUCUNSERVICE']}"
                                  rendered="#{empty etablissementController.listeServices}"
                                  escape="false" />

                    <p:outputPanel id="opService">
                        <h:panelGrid columns="2">
                            <h:outputText value="#{msgs['CONTACT.GESTION.SELECTSERVICE']}"
                                          escape="false"
                                          rendered="#{not empty etablissementController.listeServices}" />
                            <h:selectOneMenu id="sOMService"
                                             value="#{etablissementController.idServiceSel}"
                                             converter="#{intConverter}"
                                             valueChangeListener="#{etablissementController.valueIdServiceChanged}"
                                             rendered="#{not empty etablissementController.listeServices}">
                                <f:selectItems value="#{etablissementController.servicesItems}" />
                                <p:ajax event="valueChange" update="opActionsService" />
                            </h:selectOneMenu>
                        </h:panelGrid>
                        <h:panelGrid columns="3" style="padding-top:10px; margin-left:40px;">
                            <h:outputText value="#{msgs['SERVICE.AJOUT.CREER']}" escape="false" />
                            <p:commandLink id="ajout"
                                           rendered="#{not empty etablissementController.idServiceSel}"
                                           oncomplete="PF('ajoutService').show();"
                                           action="#{etablissementController.ajoutService}"
                                           update="ajoutService">
                                <f:setPropertyActionListener value="#{true}"
                                                             target="#{etablissementController.memeAdresseStructure}" />
                                <f:setPropertyActionListener value="_ajoutServiceEtape1"
                                                             target="#{sessionController.ajoutServiceCurrentPage}" />
                                <h:graphicImage alt="#{msgs['FORM.CREER']}"
                                                value="../../media/images/new.png" />
                                <p:tooltip value="#{msgs['FORM.CREER']}" />
                            </p:commandLink>
                        </h:panelGrid>
                    </p:outputPanel>
                    <t:htmlTag value="div" style="height: 20px;" />
                    <p:outputPanel id="opActionsService">
                        <h:outputText value="#{msgs['CONTACT.GESTION.SERVICESELECT']}"
                                      escape="false"
                                      rendered="#{not empty etablissementController.serviceSel}" />
                        <p:dataTable style="margin-top:10px;"
                                     value="#{etablissementController.serviceSel}"
                                     rendered="#{not empty etablissementController.serviceSel}">
                            <ui:include src="../_commun/_serviceColumns.xhtml" />

                            <p:column>
                                <h:panelGrid columns="3">
                                    <p:commandLink id="modif"
                                                   rendered="#{not empty etablissementController.idServiceSel
							and ((sessionController.adminPageAuthorized || sessionController.pageAuthorized ||
							welcomeController.admin || welcomeController.personnel || welcomeController.writer)
							|| (welcomeController.etudiant and ((sessionController.autoriserEtudiantAModifierEntreprise ||
							(!sessionController.autoriserEtudiantAModifierEntreprise
							and ((empty etablissementController.serviceSel.loginModif and
							etablissementController.serviceSel.loginCreation==sessionController.currentLogin)
							|| (etablissementController.serviceSel.loginModif==sessionController.currentLogin)))))))}"
                                                   oncomplete="PF('modifService').show();" update="modifService">
                                        <f:setPropertyActionListener value="#{false}"
                                                                     target="#{etablissementController.memeAdresseStructure}" />
                                        <f:setPropertyActionListener
                                                value="#{etablissementController.serviceSel}"
                                                target="#{etablissementController.formService}" />
                                        <f:setPropertyActionListener value="_modifServiceEtape1"
                                                                     target="#{sessionController.modifServiceCurrentPage}" />
                                        <h:graphicImage alt="#{msgs['FORM.MODIFIER']}"
                                                        value="../../media/images/edit.png" />
                                        <p:tooltip value="#{msgs['FORM.MODIFIER']}" />
                                    </p:commandLink>
                                    <p:commandLink id="suppr"
                                                   rendered="#{not empty etablissementController.idServiceSel
							and ((sessionController.adminPageAuthorized || sessionController.pageAuthorized ||
							welcomeController.admin || welcomeController.personnel || welcomeController.writer)
							|| (welcomeController.etudiant and ((sessionController.autoriserEtudiantAModifierEntreprise ||
							(!sessionController.autoriserEtudiantAModifierEntreprise
							and ((empty etablissementController.serviceSel.loginModif and
							etablissementController.serviceSel.loginCreation==sessionController.currentLogin)
							|| (etablissementController.serviceSel.loginModif==sessionController.currentLogin)))))))}"
                                                   oncomplete="PF('supprService').show();" update="supprService">
                                        <f:setPropertyActionListener value="#{false}"
                                                                     target="#{etablissementController.memeAdresseStructure}" />
                                        <f:setPropertyActionListener
                                                value="#{etablissementController.serviceSel}"
                                                target="#{etablissementController.formService}" />
                                        <h:graphicImage alt="#{msgs['FORM.SUPPRIMER']}"
                                                        value="../../media/images/delete.png" />
                                        <p:tooltip value="#{msgs['FORM.SUPPRIMER']}" />
                                    </p:commandLink>

                                    <p:commandButton id="selC" style="color:green;"
                                                     value="#{msgs['FORM.SELECTIONNER']}"
                                                     rendered="#{not empty etablissementController.idServiceSel}"
                                                     action="#{conventionController.goToCreerConventionEtape4Contact}">
                                        <f:setPropertyActionListener
                                                value="#{etablissementController.serviceSel}"
                                                target="#{conventionController.convention.service}" />
                                        <p:tooltip value="#{msgs['CONVENTION.SELECSERVICE']}" />
                                    </p:commandButton>
                                </h:panelGrid>
                            </p:column>
                        </p:dataTable>
                    </p:outputPanel>
                    <t:htmlTag value="div" style="height:30px;" />

                    <h:commandButton value="#{msgs['FORM.PREVIOUS']}"
                                     alt="#{msgs['FORM.PREVIOUS']}" title="#{msgs['FORM.PREVIOUS']}"
                                     action="creerConventionEtape2Etab" immediate="true">
                        <f:setPropertyActionListener
                                value="_creerConventionEtape2DetailsEtab"
                                target="#{sessionController.creationConventionEtape2CurrentPage}" />
                    </h:commandButton>
                </p:panel>
            </h:form>
            <ui:include src="../_commun/_panelAjoutService.xhtml" />
            <ui:include src="../_commun/_panelModifService.xhtml" />
            <ui:include src="../_commun/_panelSupprService.xhtml" />
        </p:panel>
    </ui:define>
</ui:composition>