<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:p="http://primefaces.org/ui"
	template="/stylesheets/_definedStageTemplate.xhtml">
	<ui:define name="content">
		<ui:include src="_roadmapSel.xhtml" />
		<p:panel>
			<f:facet name="header">
				<h:outputText
					value="#{msgs['CONVENTION.TITRE.DETAIL']} #{conventionController.convention.idConvention}" />
			</f:facet>
			<h:form id="formSelConvention">
				<f:facet name="header">
					<h:outputText value="#{msgs['CONVENTION.ETAPE3.SERVICE.INFO']}" />
				</f:facet>
				<t:htmlTag value="div" style="height: 20px;" />
				<h:panelGrid>
					<h:outputText
						value="#{msgs['RECHERCHEETABLISSEMENT.ERREURSELECTION']}"
						rendered="#{empty sessionController.currentManageStructure}" />
					<h:outputText value="#{msgs['SERVICE.AUCUNSERVICE']}"
						rendered="#{empty etablissementController.listeServices}"
						escape="false" />

					<p:outputPanel id="opService"
						rendered="#{not empty etablissementController.idServiceSel and !conventionController.conventionValide
		and (welcomeController.etudiant || sessionController.adminPageAuthorized || sessionController.pageAuthorized
			|| sessionController.droitsAccesMap[conventionController.convention.idCentreGestion] == beanUtils.droitAdmin 
			|| sessionController.droitsAccesMap[conventionController.convention.idCentreGestion] == beanUtils.droitEcriture)}">
						<h:panelGrid columns="2">
							<h:outputText value="#{msgs['CONTACT.GESTION.SELECTSERVICE']}"
								escape="false"
								rendered="#{not empty etablissementController.listeServices}" />
							<h:selectOneMenu id="sOMService"
								value="#{etablissementController.idServiceSel}"
								converter="#{intConverter}"
								valueChangeListener="#{etablissementController.valueIdServiceChanged}"
								rendered="#{not empty etablissementController.listeServices}">
								<f:selectItems value="#{etablissementController.servicesItems}" />
								<p:ajax event="valueChange" update="opActionsService" />
							</h:selectOneMenu>
						</h:panelGrid>
						<h:panelGrid columns="3">
							<h:outputText value="#{msgs['SERVICE.AJOUT.CREER']}"
								escape="false" />
							<p:commandLink id="ajout" oncomplete="PF('ajoutService').show();"
								action="#{etablissementController.ajoutService}"
								update="ajoutService">
								<f:setPropertyActionListener value="#{true}"
									target="#{etablissementController.memeAdresseStructure}" />
								<f:setPropertyActionListener value="_ajoutServiceEtape1"
									target="#{sessionController.ajoutServiceCurrentPage}" />
								<h:graphicImage alt="#{msgs['FORM.CREER']}"
									value="../../media/images/new.png" />
								<p:tooltip value="#{msgs['FORM.CREER']}" />
							</p:commandLink>
						</h:panelGrid>
					</p:outputPanel>
					<t:htmlTag value="div" style="height: 20px;" />
					<p:outputPanel id="opActionsService">
						<h:outputText value="#{msgs['CONTACT.GESTION.SERVICESELECT']}"
							escape="false"
							rendered="#{not empty etablissementController.serviceSel}" />
						<p:dataTable value="#{etablissementController.serviceSel}"
							rendered="#{not empty etablissementController.serviceSel}">
							<ui:include src="../_commun/_serviceColumns.xhtml" />
							<p:column>
								<p:commandLink id="modif"
									rendered="#{not empty etablissementController.idServiceSel and !conventionController.conventionValide
						and ((sessionController.adminPageAuthorized || sessionController.pageAuthorized
						|| sessionController.droitsAccesMap[conventionController.convention.idCentreGestion] == beanUtils.droitAdmin 
						|| sessionController.droitsAccesMap[conventionController.convention.idCentreGestion] == beanUtils.droitEcriture)
						|| (welcomeController.etudiant and ((sessionController.autoriserEtudiantAModifierEntreprise ||
						(!sessionController.autoriserEtudiantAModifierEntreprise 
						and ((empty etablissementController.serviceSel.loginModif and
						etablissementController.serviceSel.loginCreation==sessionController.currentLogin)
						|| (etablissementController.serviceSel.loginModif==sessionController.currentLogin)))))))}"
									oncomplete="PF('modifService').show();" update="modifService">
									<f:setPropertyActionListener value="#{false}"
										target="#{etablissementController.memeAdresseStructure}" />
									<f:setPropertyActionListener
										value="#{etablissementController.serviceSel}"
										target="#{etablissementController.formService}" />
									<f:setPropertyActionListener
										value="#{etablissementController.serviceSel}"
										target="#{conventionController.convention.service}" />
									<f:setPropertyActionListener value="_modifServiceEtape1"
										target="#{sessionController.modifServiceCurrentPage}" />
									<h:graphicImage alt="#{msgs['FORM.MODIFIER']}"
										value="../../media/images/edit.png" />
									<p:tooltip value="#{msgs['FORM.MODIFIER']}" />
								</p:commandLink>

								<p:commandButton id="selectionService"
									value="#{msgs['FORM.SELECTIONNER']}" style="color:green;"
									rendered="#{not empty etablissementController.idServiceSel and !conventionController.conventionValide
						and (welcomeController.etudiant || sessionController.adminPageAuthorized || sessionController.pageAuthorized
						|| sessionController.droitsAccesMap[conventionController.convention.idCentreGestion] == beanUtils.droitAdmin 
						|| sessionController.droitsAccesMap[conventionController.convention.idCentreGestion] == beanUtils.droitEcriture)}"
									oncomplete="PF('demandeConfirmModifService').show();"
									update="opActionsService">
									<f:setPropertyActionListener
										value="#{etablissementController.serviceSel}"
										target="#{etablissementController.formService}" />
									<f:setPropertyActionListener
										value="#{etablissementController.serviceSel}"
										target="#{conventionController.convention.service}" />
									<p:tooltip value="#{msgs['FORM.SELECTIONNER']}" />
								</p:commandButton>
							</p:column>
						</p:dataTable>

						<p:dialog id="demandeConfirmModifService"
							widgetVar="demandeConfirmModifService">
							<f:facet name="header">
								<h:outputText
									value="#{msgs['CONVENTION.MODIF.SERVICE.DEMANDE']}" />
							</f:facet>
							<h:panelGrid columns="2" align="center">
								<h:graphicImage alt="#{msgs['GENERAL.WARNING']}"
									title="#{msgs['GENERAL.WARNING']}"
									value="../../media/images/warning_50px.png" />
								<h:outputText
									value="#{msgs['CONVENTION.MODIF.SERVICE.QUESTION']}"
									escape="false" />
							</h:panelGrid>
							<h:panelGrid columns="3">
								<p:commandButton value="#{msgs['FORM.OUI']}"
									oncomplete="PF('demandeConfirmModifService').hide();"
									action="#{conventionController.goToConventionEtape3ServiceModif}" />
								<t:htmlTag value="div" style="width: 100px;" />
								<p:commandButton value="#{msgs['FORM.NON']}"
									onclick="PF('demandeConfirmModifService').hide();" />
							</h:panelGrid>
						</p:dialog>
					</p:outputPanel>
				</h:panelGrid>
			</h:form>
			<ui:include src="../_commun/_panelAjoutService.xhtml" />
			<ui:include src="../_commun/_panelModifService.xhtml" />
		</p:panel>
	</ui:define>
</ui:composition>