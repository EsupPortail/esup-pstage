<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

	<h:form style="padding-top:15px; padding-bottom:20px;">
		<p:panel id="indicateursStats">
			<f:facet name="header">
				<h:outputText value="#{statistiquesConventionController.message}" />
				<h:outputText value=" pour l'annÃ©e universitaire "
					rendered="#{not empty statistiquesConventionController.critereUnLib 
								|| not empty statistiquesConventionController.critereDeuxLib}" />
				<h:outputText
					value="#{statistiquesConventionController.annee_scolaire}"
					rendered="#{not empty statistiquesConventionController.critereUnLib 
								|| not empty statistiquesConventionController.critereDeuxLib}" />
			</f:facet>

			<t:div>
				<t:htmlTag value="center">
					<p:commandButton
						value="#{msgs['CONVENTION.STATS.INFO.ENREGISTRER']}"
						action="#{statistiquesConventionController.edition}"
						icon="ui-icon-disk" style="margin:10px;" ajax="false" />
				</t:htmlTag>
				<c:set var="map" value="#{statistiquesConventionController.map}" />
				<c:choose>
					<c:when
						test="#{empty statistiquesConventionController.critereUnLib and empty statistiquesConventionController.critereDeuxLib}">
						<c:set var="liste" value="#{map['all']}" />
					</c:when>
					<c:otherwise>
						<c:set var="liste"
							value="#{map[statistiquesConventionController.annee_scolaire]}" />
					</c:otherwise>
				</c:choose>

				<c:set var="total" value="0" />
				<c:set var="libPrec" value="" />
				<c:set var="sousTotal" value="0" />
				<c:set var="pourcent" value="0" />

				<c:forEach var="statsItem" items="#{liste}">
					<c:set var="total" value="#{total+statsItem.number}" />
				</c:forEach>

				<table>
					<tr style="font-size: 14px; font-weight: bold; text-align: center;">
						<td><h:outputText
								value="#{statistiquesConventionController.critereUnLib}" /></td>
						<td><h:outputText
								value="#{statistiquesConventionController.critereDeuxLib}" /></td>
						<td><h:outputText value="#{msgs['CVT.NBRE.STAGES.LIB']}" />
						</td>
						<td><h:outputText value="#{msgs['CVT.POURCENT.TOTAL.LIB']}" />
						</td>
					</tr>
					<tr style="height: 10px;">
					</tr>

					<c:forEach var="list" items="#{liste}">
						<c:if
							test="#{list.libPriorCriteria ne libPrec and (!empty libPrec)}">
							<tr>
								<td><b><h:outputText value="#{libPrec}" /></b></td>
								<td><b><h:outputText value="sous-total" /></b></td>
								<td><b><h:outputText value="#{sousTotal}" /></b></td>
								<td><b><h:outputText value="#{pourcent} %" /></b></td>
							</tr>
							<tr style="height: 10px;">
							</tr>
							<c:set var="sousTotal" value="0" />
							<c:set var="pourcent" value="0" />
						</c:if>

						<tr>
							<td><h:outputText value="#{list.libPriorCriteria}" /></td>
							<td><h:outputText value="#{list.lib}" /></td>
							<td><h:outputText value="#{list.number}" /></td>
							<td><h:outputText value="#{list.percentage} %" /></td>
						</tr>

						<c:set var="libPrec" value="#{list.libPriorCriteria}" />
						<c:set var="sousTotal" value="#{sousTotal+list.number}" />
						<c:set var="pourcent" value="#{pourcent+list.percentage}" />

					</c:forEach>

					<tr>
						<td><b><h:outputText value="#{libPrec}" /></b></td>
						<td><b><h:outputText value="sous-total" /></b></td>
						<td><b><h:outputText value="#{sousTotal}" /></b></td>
						<td><b><h:outputText value="#{pourcent} %" /></b></td>
					</tr>

					<tr>
						<td><b><h:outputText
									value="#{statistiquesConventionController.critereUnLib}" /></b></td>
						<td><b><h:outputText value="Total" /></b></td>
						<td><b><h:outputText value="#{total}" /></b></td>
						<td><b><h:outputText value="100 %" /></b></td>
					</tr>
				</table>

				<t:htmlTag value="div" style="height:20px;" />

				<t:htmlTag value="center">
					<p:commandButton id="idLienEnregisterFormatExcel"
						value="#{msgs['CONVENTION.STATS.INFO.ENREGISTRER']}"
						action="#{statistiquesConventionController.edition}"
						icon="ui-icon-disk" ajax="false" />
				</t:htmlTag>

				<t:htmlTag value="div" style="height:25px;" />
				<p:commandButton update="panelConsultation"
					value="#{msgs['GENERAL.RETOUR']}" immediate="true">
					<f:setPropertyActionListener value="_consultationCentre_stats"
						target="#{sessionController.consultationCentreCurrentPage}" />
				</p:commandButton>

				<t:htmlTag value="div" style="height:5px;" />
			</t:div>
		</p:panel>
	</h:form>
</ui:composition>