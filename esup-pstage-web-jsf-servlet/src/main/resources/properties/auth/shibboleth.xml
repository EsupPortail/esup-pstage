<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns:secu="http://www.springframework.org/schema/security"
	xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd 
                        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-2.0.1.xsd 
    ">

	<bean id="preauthEntryPoint"
		class="org.springframework.security.ui.preauth.PreAuthenticatedProcessingFilterEntryPoint" />

	<secu:http entry-point-ref="preauthEntryPoint">
		<secu:intercept-url pattern="/auth/shibb/*"
			access="IS_AUTHENTICATED_FULLY" />
		<secu:intercept-url pattern="/**"
			access="IS_AUTHENTICATED_FULLY" />
		<secu:form-login login-page="/auth/shibb/"
			default-target-url="/stylesheets/depot/welcome.jsp"
			authentication-failure-url="/stylesheets/depot/welcome.jsp" />
		<secu:logout logout-url="/logout" logout-success-url="/stylesheets/depot/welcome.jsp" />
	</secu:http>

	<secu:authentication-manager alias="authenticationManager" />

	<bean id="shibbolethProcessingFilter"
		class="org.esupportail.pstage.security.ui.preauth.shibboleth.ShibbolethPreAuthenticatedProcessingFilter">
		<!--
			class="org.springframework.security.ui.preauth.j2ee.J2eePreAuthenticatedProcessingFilter">
			Use class
			org.springframework.security.ui.preauth.header.RequestHeaderPreAuthenticatedProcessingFilter
			instead to throw PreAuthenticatedCredentialsNotFoundException when
			principalRequestHeader is not found.
		-->
		<secu:custom-filter position="PRE_AUTH_FILTER" />
		<property name="authenticationManager" ref="authenticationManager" />
		<property name="authenticationDetailsSource">
			<bean
				class="org.esupportail.pstage.security.ui.preauth.shibboleth.ShibbolethPreAuthenticatedWebAuthenticationDetailsSource">
				<!--
					property "attributesSplitter" is optional, its default value is ";"
				-->
				<property name="attributesSplitter" value=":" />
				<property name="authoritiesAttribute" value="Shib-Authentication-Method" />
			</bean>
		</property>
		<property name="principalRequestHeader" value="Shib-Application-ID" />
	</bean>

	<bean id="shibbolethAuthProvider"
		class="org.springframework.security.providers.preauth.PreAuthenticatedAuthenticationProvider">
		<secu:custom-authentication-provider />
		<property name="preAuthenticatedUserDetailsService">
			<!--
				<bean
				class="org.springframework.security.providers.preauth.PreAuthenticatedGrantedAuthoritiesUserDetailsService"
				/>
			-->
			<bean
				class="org.esupportail.pstage.security.providers.preauth.shibboleth.ShibbolethGrantedAuthoritiesUserDetailsService" />
		</property>
	</bean>

</beans>